---
title: "Server Apps"
description: "Built-in app server-side modules: Mail, News, Camera, Messages"
---

# Server App Modules

Server-side handlers for built-in tablet applications.

## Files

- `server/apps/mail.lua` - Email system
- `server/apps/news.lua` - News/Articles system
- `server/apps/camera.lua` - Photo capture
- `server/apps/messages/` - Phone message sync

---

## Mail App

### Database Tables

```sql
-- Mail users
tablet_mail_users (id, identifier, email, display_name, created_at)

-- Mail threads
tablet_mail_threads (id, subject, created_at)

-- Thread participants
tablet_mail_thread_participants (thread_id, user_id, is_read, archived)

-- Messages
tablet_mail_messages (id, thread_id, sender_id, body, created_at)
```

### Callbacks

| Callback | Description |
|----------|-------------|
| `tablet:mail:register` | Register email address |
| `tablet:mail:getUser` | Get current user's mail info |
| `tablet:mail:getThreads` | Get mail threads (inbox/archived) |
| `tablet:mail:getThread` | Get single thread with messages |
| `tablet:mail:send` | Send new email |
| `tablet:mail:reply` | Reply to thread |
| `tablet:mail:markRead` | Mark thread as read |
| `tablet:mail:archive` | Archive thread |
| `tablet:mail:unarchive` | Unarchive thread |
| `tablet:mail:searchUsers` | Search users by email |
| `tablet:mail:getUnreadCount` | Get unread count |

### Example Usage

```lua
-- Send email
lib.callback.await('tablet:mail:send', false, {
    to = 'john.doe@tablet.mail',
    subject = 'Hello',
    body = 'This is a test email.'
})
```

---

## News App

### Database Tables

```sql
-- News channels (categories)
tablet_news_channels (id, slug, name, description, icon, color)

-- Articles
tablet_news_articles (id, channel_id, author_id, title, content,
                      image_url, published, created_at, updated_at)
```

### Callbacks

| Callback | Description |
|----------|-------------|
| `tablet:news:getChannels` | Get all news channels |
| `tablet:news:getArticles` | Get articles (optionally by channel) |
| `tablet:news:getArticle` | Get single article |
| `tablet:news:canWrite` | Check if player can create articles |
| `tablet:news:createArticle` | Create new article |
| `tablet:news:updateArticle` | Update existing article |
| `tablet:news:deleteArticle` | Delete article |
| `tablet:news:getMyArticles` | Get player's articles |

### Write Permissions

Configure which jobs can write news articles:

```lua
Config.News = {
    WritePermissions = {
        { job = 'reporter' },
        { job = 'police', minGrade = 4 },  -- Captains+
    }
}
```

---

## Camera App

### Configuration

```lua
Config.Camera = {
    Provider = 'discord',  -- Only 'discord' supported
    Webhook = 'https://discord.com/api/webhooks/...'
}
```

### Callbacks

| Callback | Description |
|----------|-------------|
| `tablet:camera:getConfig` | Get camera configuration |

### How It Works

1. Client activates mobile phone camera
2. `screenshot-basic` captures the screen
3. Image uploads to Discord webhook
4. URL returned to NUI for display/gallery

### Discord Webhook Setup

1. Create a webhook in your Discord server
2. Copy the webhook URL
3. Add to `config/config.lua`:

```lua
Config.Camera = {
    Provider = 'discord',
    Webhook = 'YOUR_WEBHOOK_URL'
}
```

<Warning>
Never share your webhook URL publicly. Anyone with the URL can upload images to your channel.
</Warning>

---

## Messages App (Phone Sync)

The Messages app syncs with supported phone resources.

### Supported Phones

| Phone | Adapter File |
|-------|--------------|
| lb-phone | `lbPhoneAdapter.lua` |
| qb-phone | `qbPhoneAdapter.lua` |
| qs-smartphone | `qsSmartphoneAdapter.lua` |
| roadphone | `roadphoneAdapter.lua` |
| gksphone | `gksphoneAdapter.lua` |

### File Structure

```
server/apps/messages/
├── adapters/
│   ├── baseAdapter.lua          # Base adapter class
│   ├── lbPhoneAdapter.lua       # lb-phone support
│   ├── qbPhoneAdapter.lua       # qb-phone support
│   ├── qsSmartphoneAdapter.lua  # qs-smartphone support
│   ├── roadphoneAdapter.lua     # roadphone support
│   └── gksphoneAdapter.lua      # gksphone support
├── phoneDetector.lua            # Auto-detect phone resource
├── init.lua                     # Initialize message system
└── phoneSyncCallbacks.lua       # lib.callback handlers
```

### Callbacks

| Callback | Description |
|----------|-------------|
| `tablet:messages:getSyncStatus` | Check if phone sync is enabled |
| `tablet:messages:getPhoneNumber` | Get player's phone number |
| `tablet:messages:getContacts` | Get contacts from phone |
| `tablet:messages:getConversations` | Get SMS conversations |
| `tablet:messages:getMessages` | Get messages in conversation |
| `tablet:messages:sendMessage` | Send SMS |
| `tablet:messages:markAsRead` | Mark conversation as read |
| `tablet:messages:createConversation` | Start new conversation |

### Phone Detection

The system auto-detects which phone resource is running:

```lua
-- phoneDetector.lua
local function detectPhone()
    if GetResourceState('lb-phone') == 'started' then
        return 'lb-phone'
    elseif GetResourceState('qb-phone') == 'started' then
        return 'qb-phone'
    end
    -- ... check other phones
    return nil
end
```

### Creating Custom Adapter

To add support for a new phone:

1. Create `server/apps/messages/adapters/myPhoneAdapter.lua`
2. Extend `BaseAdapter`:

```lua
local BaseAdapter = PhoneAdapters.BaseAdapter

PhoneAdapters.MyPhone = {}
setmetatable(PhoneAdapters.MyPhone, { __index = BaseAdapter })

function PhoneAdapters.MyPhone.getPhoneNumber(source)
    -- Return player's phone number
end

function PhoneAdapters.MyPhone.getConversations(source)
    -- Return conversations list
end

-- ... implement other methods
```

3. Register in `phoneDetector.lua`
